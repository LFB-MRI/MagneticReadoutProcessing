---
title: "Development of a permanent magnet characterisation framework for use in low-field MRI systems"
subtitle: "FH Aachen – University of Applied Sciences"
author: Marcel Ochsendorf
institute: Faculty of Electrical Engineering and Information Technology - Information Systems Engineering
date: today
date-format: "dddd, [the] D[<sup style='font-size:65%;font-style:italic;'>th</sup>] [of] MMMM, YYYY"
embed-resources: false
format: coeos-revealjs
---

```{r}
#| include: false
sysfonts::font_add_google("Alegreya Sans", "Alegreya Sans", regular.wt = 300)
showtext::showtext_auto()
source("_extensions/mcanouil/coeos/setup-ggplot2-coeos.R")
```



## Introduction



::: {.container}
:::: {.col}
<h4 style="text-align: center;"><img style="text-align: center;" src="images/open_source_magnetic_resonance_imaging_projects_MagnetLUMC_feature.png" alt="image"></h4>
::::
:::


<aside class="notes">
* stellen wir uns vor wir möchten ein kleines MRT
* dazu benötigen wir einen möglichst homogenen magneten welcher das Hauptfeld erzeugt.
* B0 oder Nullgradient stellt die resonanzbedingungen her = spinausrichtung

* für kleine Feldstärken von <0.3T = niederfeld
* ist es möglich diesen aus vielen kleinen permanent Magneten zu bauen (s bild)
</aside>

## Problem

<br />

<p class="fragment">&#x2022; Permanent magnets differ in their field strength due to their manufacturing process and environmental changes</p>
<p class="fragment">&#x2022; This influences the homogeneity of the assembled magnet</p>
<p class="fragment">&#x2022; It can be improved by means of a complex shimming process</p>

<aside class="notes">
* das problem  herstellung physik diese Magnete
* nicht optimal für die gemsamt homogenität
* mittels shimming im nachhinein = auswändig
* GIBT ES EINEN BESSEREN PROZESS ?
</aside>

--- 

## Solution


<p class="fragment">&#x2022; Measure magnets in advance</p>
<p class="fragment">&#x2022; Execute optimization or sorting algorithms on the magnet field data</p>
<p class="fragment">&#x2022; Build an optimized magnet</p>

<aside class="notes">
* diverse projekte welche einzelne algrothmen dazu haben
* jedoch nicht kompatible zueinander

DESWEGEN: wurde entwickelt
</aside>

---

--- 

## But

<p class="fragment">&#x2022; Existing projects follow this approach but only implement individual parts</p>
<p class="fragment">&#x2022; Incompatible data-formats</p>
<p class="fragment">&#x2022; Complex magnetic field sensor integrations</p>
<p class="fragment">&#x2022; Usage of non open source software</p>

<aside class="notes">
* diverse projekte welche einzelne algrothmen dazu haben
* jedoch nicht kompatible zueinander

DESWEGEN: wurde entwickelt
</aside>

---


##  

<h1 class="r-fit-text" style="text-align: center;">MagneticReadoutProcessing</h1>

<p class="fragment">Provides and user-oriented **open** magnetic field hardware and software framework:</p>
<br />
<p class="fragment">&#x2022; Hardware support for several magnetic field sensors</p>
<br />
<p class="fragment">&#x2022; Ready to use data analysis pipelines</p>
<br />
<p class="fragment">&#x2022; Easy to integrate and extend into existing projects</p>



<aside class="notes">
* dazu wurde das MRP framework erstellt
* welche die folgenden Probleme behen soll:
* viele derzeitigen magnetfeldmessungen in low field mrt bereich verwenden magentfeld sensoren
* datenanalyse pipelines sind identsisch bis auf einzelne algorithmen
* gemeinsame grundlage soll geschaffen werden um solche optimierungsalgorithmen verlgeichen zu können
</aside>


---

### Hardware Framework

Cheap and easy to construct magnetic field sensors:
<br />
<br />
<p class="fragment">&#x2022; One software for most common digital magnetic field sensors</p>
<br />
<p class="fragment">&#x2022; Synchronised multi sensor setups</p>
<br />
<p class="fragment">&#x2022; Universal and interchangeable mount for different magnet shapes</p>


<aside class="notes">
* es werden 8 von den günstigen sensoren verwendet
* diese werden in ähnlichen projketen verwendet
* Magnet mount für viele Magnetformen anpassbar
* ohne dass die sensor hardware geaendert werden muss
</aside>


---

### Hardware Framework

::: {.container}
:::: {.col}
<h4 style="text-align: center;">1D Static Sensor</h4>
::::
:::

::: {.container}
:::: {.col}
<img src="images/1D_sensor.png" alt="image" height="320px">
::::

:::: {.col}
<img src="images/1D_sensor_measurement.png" alt="image" height="320px" >
::::
:::

<aside class="notes">
* einfachster möglicher sensor
* nur ein microcontroller und der mangetfeld sensor
</aside>

---

### Hardware Framework

::: {.container}
:::: {.col}
<h4 style="text-align: center;">3D Rotational Sensor</h4>
::::
:::

::: {.container}
:::: {.col}
<img src="images/3D_sensor.png" alt="image" height="320px">
::::

:::: {.col}
<img src="images/3D_sensor_measurement.png" alt="image" height="320px" >
::::
:::

<aside class="notes">
* kartographiert den eingesetzten magneten
* zeigt interaktion mit einem manipulator
* 3D Karte des feldes
</aside>

---

### Software Framework

Provides rapid development of analysis functions without the need to implement typical data processing pipelines:

<br />
<p class="fragment">&#x2022; Expandable **open** data types for magnetic field data</p>
<br />
<p class="fragment">&#x2022; Prebuild analysis pipelines ready for user customisation</p>
<br />
<p class="fragment">&#x2022; Full online documentation,tests and user tutorials</p>

<aside class="notes">
* mit der hardware können wird magnetfeld daten aufnehmen
* jetzt fehlt noch die software dazu
* messdaten und meta-daten management
* integration zu andern projekten magpylib, matlab, 
* analysepipeline schauen wir uns später an
* volle doku, getestet

</aside>

---

### User Interaction Points

![](images/MRP_high_level_overview.png)

<aside class="notes">
* nutzer kann jeden punkt implementieren ohne die komplette pipelines zu implemtieren
* dieses konzept wird im folgenden demonstriert an zwei usecases
</aside>

---

## Use Cases

Two examples are used to demonstrate the practical application of the framework:

<br />
<p class="fragment">&#x2022; Characterisation of a *MM5603NJ* and *TLV493D* to measure background noise, temperature coefficients and dynamic range</p>
<br />
<p class="fragment">&#x2022; Usage of the chracterised sensor for sorting permanent magnets and measure magnetic fields</p>


<aside class="notes">
* dazu wurde das entwicklete framework verwendet
* voll automatisiert
* diese sensoren als beispiel für die in anderen arbeiteten verwendeten sensoren
* diese wie TLV wurden nur anhand von Datenblatt chrakterisiert
* Ergebnisse werden bei der magnet chrakterisierung verwendet
</aside>
---



### Sensor Chraterisation Setup

![](images/Sensor_evaluation_setup_for_linearity_measurements.png)

<aside class="notes">
* vereinfachter aufbau fuer alle gleich
* sensorplatte zeigen
* gleiche befdinungen
* zweites set an sensoren
</aside>

---

### Sensor Chraterisation Setup

::: {.container}
:::: {.col}
<p style="text-align: center;"><img style="text-align: center;" src="images/eval.png" alt="image" height="270px"></p>
::::
:::


|                       | TLV493D | MMC5603NJ |
| --------------------- | ------- | --------- |
| Temperature-Sensor    | yes     | yes       |
| Resolution [uT]       | 98      | 0.007     |
| Dynamic Range [mT]    | ±130.0  | ±3        |
| Background-Noise [uT] | 100     | 0.2       |

</p>

<aside class="notes">
* unterschiedliche messbereiche
* sind diese passend für die magnet chrakterisierung bis zu welchem grad
</aside>

---

### Chraterisation results : Noise

::: {.container}
:::: {.col}
<img src="images/eval/n_tlv.png" alt="image" >
::::

:::: {.col}
<img src="images/eval/n_mmc.png" alt="image" >
::::
:::

<aside class="notes">
* TLV: 98uT MMC: 0.007uT
* rauschen gibt untere greenze an
* TLV abweichung 0.2C (bitsprüunge) => nicht für temperatur compensation zu nutzen
* TLV mehr als doppelt so hoch wie im datenblatt (12bit 4096/260mT)
* Ergebnisse mit einem zweiten set an sensoren verifiziert
* MMC im noise weit unter datenblatt
</aside>

---

### Chraterisation results : Temperature

::: {.container}
:::: {.col}
<img src="images/eval/t_tlv.png" alt="image" >
::::

:::: {.col}
<img src="images/eval/t_mmc.png" alt="image" >
::::
:::

<aside class="notes">
* TLV: keine Angabe
* Temperaturen wurden mit ref thermometer erstellt.
* TLV doppelt so steil liegt bei 5% jedoch im Datenblatt zum drift
</aside>


---

### Chraterisation results : Dynamic Range

::: {.container}
:::: {.col}
<img src="images/eval/dr_tlv.png" alt="image" >
::::

:::: {.col}
<img src="images/eval/dr_mmc.png" alt="image" >
::::
:::

<aside class="notes">
* TLV: 130mT MMC: 3mT
* DR am äußeren messbreich weiterhin gut
* TLV bleibt linearbis hin zum doppelten des messbereichs
* nicht gültig für andere chips
* gleiche aussehende abweichung weisst anfängliche fehler im messaufbau hin
</aside>

---

### Magnet Sorting

![](images/magnet_sorting_pipeline.png)


1. Configure sensor and measurement parameters
2. Run measurement
3. Implement custom filter function
4. Run analysation pipeline using custom algorithm


<aside class="notes">
* Ziel: automatisierten Sortieren von Magneten um dann spätereinen Hallbach ring zu erstellen
* Diese Daten dann in optimierungsalgorithmen zu verwenden.
* Vordefinierte Pipeline verwendet
* Die X besten Magnete sollen anhand mittelwert sollen zurueckgegben werden
</aside>


---

#### Magnet Sorting - DEMO MRP

* Simple installation using pip
* Commandline interface available system wide
* Compatible with Docker and CI pipelines

![](images/MRP.gif)

---

#### Magnet Sorting - DEMO MRPCli

* Generate automated measurement using hardware sensors
* Save results to filesystem for later analysation

![](images/MRPCli.gif)



---

#### Magnet Sorting - DEMO MRPUdpp

* Execution of pre-configured analysation and pipeline
* User implements filter algorithm only


![](images/MRPUdpp.gif)




---

## Conclusion

* The implemented framework is successfully used to automatically record and analyse measurement data
* Characterised sensors are only conditionally suitable for measuring low field MRI fields
* Implementation of other sensor types required for a wider use of the implemented solution

<aside class="notes">
* dies liegt vorallem an dem Messbereich und Aufloesung
* implementierung von besonders analogen sensoren ist notwendig um die geforderten genauigkeiten von B0 feldern genauigkeiten zu vermessen
* verbreitung des frameworks durch integration in bestehende optimierungs projekte such as the MRIHallbachDesigner
</aside>




# 
<h1 class="r-fit-text" style="text-align: center;">Questions ?</h1>

<table>
<tr><td><p>[<img src="images/github-mark-white.png" alt="image" width="150" height="auto">](https://github.com/LFB-MRI/MagneticReadoutProcessing) </p></td><td><p>[<img src="images/researchgate.svg" alt="image" width="150" height="auto">](https://www.researchgate.net/publication/374388764_Development_of_a_permanent_magnet_characterisation_framework_for_use_in_low-field_MRI_systems) </p><td>[<img src="images/avatar.png" alt="image" width="150" height="auto">](https://marcelochsendorf.com)</td><td><p>[<img src="images/pypi.svg" alt="image" width="150" height="auto">](https://pypi.org/project/MagneticReadoutProcessing/) </p></td><td><p>[<img src="images/rtd.png" alt="image" width="150" height="auto">](https://magneticreadoutprocessing.readthedocs.io/en/latest/) </p></td></tr>
</table>
